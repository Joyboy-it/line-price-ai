# üì± ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE Messaging API

## üéØ ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå
‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á LINE Group ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡∏°‡πà

**‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á:** ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÑ‡∏°‡πà‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û)

---

## üìã ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

### 1Ô∏è‚É£ ‡∏™‡∏£‡πâ‡∏≤‡∏á LINE Messaging API Channel

1. ‡πÄ‡∏Ç‡πâ‡∏≤ https://developers.line.biz/console/
2. Login ‡∏î‡πâ‡∏ß‡∏¢ LINE Account
3. ‡∏Ñ‡∏•‡∏¥‡∏Å **Create a new provider** (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
   - ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Provider ‡πÄ‡∏ä‡πà‡∏ô "‡∏ß‡∏á‡∏©‡πå‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå"
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **Create a Messaging API channel**
   - Channel name: ‡πÄ‡∏ä‡πà‡∏ô "‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤"
   - Channel description: ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏±‡πâ‡∏ô‡πÜ
   - Category: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
   - Subcategory: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏¢‡πà‡∏≠‡∏¢
5. ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏•‡∏¥‡∏Å **Create**

### 2Ô∏è‚É£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Channel

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà Channel ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö **Messaging API**
3. ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏´‡∏≤ **Channel access token**
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **Issue** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á token
5. **‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å token** (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

### 3Ô∏è‚É£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variable

‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô `.env.local`:
```bash
LINE_CHANNEL_ACCESS_TOKEN=your_long_channel_access_token_here
```

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:**
```bash
LINE_CHANNEL_ACCESS_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### 4Ô∏è‚É£ ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤ LINE Group

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö **Messaging API**
2. ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏´‡∏≤ **Bot basic ID** ‡∏´‡∏£‡∏∑‡∏≠ **QR code**
3. ‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡∏î‡πâ‡∏ß‡∏¢ LINE App
4. ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
5. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà

### 5Ô∏è‚É£ ‡∏´‡∏≤ LINE Group ID

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ LINE Bot Designer (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)**
1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á LINE Bot Designer
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏°
3. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
4. ‡∏î‡∏π Group ID ‡∏à‡∏≤‡∏Å webhook event

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡πÉ‡∏ä‡πâ Webhook URL**
1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Developers Console
2. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
3. ‡∏î‡∏π `source.groupId` ‡∏à‡∏≤‡∏Å webhook payload

**‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Group ID:**
```
C1234567890abcdef1234567890abcdef
```

### 6Ô∏è‚É£ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ **Admin ‚Üí ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤**
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
3. ‡∏Å‡∏£‡∏≠‡∏Å **LINE Group ID** ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 5
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å**

### 7Ô∏è‚É£ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö

1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ **Admin ‚Üí ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏≤‡∏Ñ‡∏≤**
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE Group ID ‡πÅ‡∏•‡πâ‡∏ß
3. ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE

**‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:**
```
üì¢ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 04/02/2569 21:30

üì∏ [‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤]
```

---

## üîß Database Migration

‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ö‡∏ô VPS:

```bash
# SSH ‡πÄ‡∏Ç‡πâ‡∏≤ VPS
ssh root@157.245.156.65

# ‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
cd /apps/Line_price

# Pull code ‡πÉ‡∏´‡∏°‡πà
git pull origin main

# ‡∏£‡∏±‡∏ô migration
psql -U postgres -h localhost -d line_price_db -f sql/migrations/002_add_line_group_id.sql

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
psql -U postgres -h localhost -d line_price_db -c "\d price_groups"

# Build ‡πÅ‡∏•‡∏∞ restart
npm run build
pm2 restart line-price-ai
```

---

## ‚úÖ Checklist

- [ ] ‡∏™‡∏£‡πâ‡∏≤‡∏á LINE Messaging API Channel
- [ ] ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å Channel Access Token
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° `LINE_CHANNEL_ACCESS_TOKEN` ‡πÉ‡∏ô `.env.local`
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Bot ‡πÄ‡∏Ç‡πâ‡∏≤ LINE Group
- [ ] ‡∏´‡∏≤ LINE Group ID
- [ ] ‡∏£‡∏±‡∏ô database migration
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ LINE Group ID ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°

---

## üêõ ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡πà‡∏á
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `LINE_CHANNEL_ACCESS_TOKEN` ‡πÉ‡∏ô `.env.local`
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE Group ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Bot ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° LINE
‚úÖ ‡∏î‡∏π error log: `pm2 logs line-price-ai`

### Bot ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Channel Access Token ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Bot ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Messaging API ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà

### Error: "Invalid reply token"
‚úÖ ‡πÉ‡∏ä‡πâ Push Message API ‡πÅ‡∏ó‡∏ô Reply API
‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Group ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üìû ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö
